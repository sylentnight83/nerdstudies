!function(e){"use strict";redux.field_objects=redux.field_objects||{},redux.field_objects.repeater=redux.field_objects.repeater||{},redux.field_objects.repeater.sort_repeaters=function(r){r.hasClass("redux-container-repeater")||(r=r.parents(".redux-container-repeater:first")),r.find(".redux-repeater-accordion-repeater").each(function(r){var t=e(this).attr("data-sortid"),a=e(this).find("[name*='["+t+"]']");a.each(function(){e(this).attr("name",e(this).attr("name").replace("["+t+"]","["+r+"]"))});var i=e(this).find("select[name*='["+t+"]']");i.each(function(){e(this).attr("name",e(this).attr("name").replace("["+t+"]","["+r+"]"))}),e(this).attr("data-sortid",r);var d=e(this).find(".ui-accordion-header"),n=d.attr("id").split("-header-");d.attr("id",n[0]+"-header-"+r),n=d.attr("aria-controls").split("-panel-"),d.attr("aria-controls",n[0]+"-panel-"+r);var c=e(this).find(".ui-accordion-content"),n=c.attr("id").split("-panel-");c.attr("id",n[0]+"-panel-"+r),n=c.attr("aria-labelledby").split("-header-"),c.attr("aria-labelledby",n[0]+"-header-"+r)})},redux.field_objects.repeater.init=function(r){r||(r=e(document).find(".redux-group-tab:visible").find(".redux-container-repeater:visible")),e(r).each(function(r){var t=e(this),a=t;if(t.hasClass("redux-field-container")||(a=t.parents(".redux-field-container:first")),!a.is(":hidden")&&a.hasClass("redux-field-init")){a.removeClass("redux-field-init");var a=t;t.hasClass("redux-field-container")||(a=t.parents(".redux-field-container:first"));var i=a.attr("data-id"),d=t.find(".redux-repeater-accordion-repeater:last-child");if(redux.repeater[i].blank=d.clone().wrap("<p>").parent().html(),a.hasClass("redux-container-repeater")&&a.addClass("redux-field-init"),a.hasClass("redux-field-init")){a.removeClass("redux-field-init");var n=t.find(".redux-repeater-accordion").accordion({header:"> div > fieldset > h3",collapsible:redux.repeater[i].collapsible,active:redux.repeater[i].active,beforeActivate:function(r,a){if("function"==typeof reduxRepeaterAccordionBeforeActivate&&reduxRepeaterAccordionBeforeActivate(e(this),t,r,a),!redux.repeater[i].forced_collapse){if(a.newHeader[0])var d=a.newHeader,n=d.next(".ui-accordion-content");else var d=a.oldHeader,n=d.next(".ui-accordion-content");var c="true"==d.attr("aria-selected");return d.toggleClass("ui-corner-all",c).toggleClass("accordion-header-active ui-state-active ui-corner-top",!c).attr("aria-selected",(!c).toString()),d.children(".ui-icon").toggleClass("ui-icon-triangle-1-e",c).toggleClass("ui-icon-triangle-1-s",!c),n.toggleClass("accordion-content-active",!c),c?n.slideUp():n.slideDown(),!1}},activate:function(r,a){"function"==typeof reduxRepeaterAccordionActivate&&reduxRepeaterAccordionActivate(e(this),t,r,a),e.redux.initFields()},heightStyle:redux.repeater[i].height_style,icons:{header:redux.repeater[i].icons.closed,activeHeader:redux.repeater[i].icons.open}});1==redux.repeater[i].sortable?n.sortable({axis:"y",handle:"h3",connectWith:".redux-repeater-accordion",placeholder:"ui-state-highlight",start:function(e,r){r.placeholder.height(r.item.height()),r.placeholder.width(r.item.width())},stop:function(r,t){t.item.children("h3").triggerHandler("focusout"),redux.field_objects.repeater.sort_repeaters(e(this)),redux_change(e(this))}}):n.find("h3.ui-accordion-header").css("cursor","pointer"),t.find(".redux-repeater-accordion-repeater .bind_title").on("change keyup",function(r){var t;t=e(r.target).find(":selected").text().length>0?e(r.target).find(":selected").text():e(r.target).val(),e(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(t),redux_change(e(this))}),t.find(".redux-repeaters-remove").live("click",function(){redux_change(e(this));var r=e(this).parents(".redux-container-repeater:first"),a=r.attr("data-id");redux.repeater[a].blank=e(this).parents(".redux-repeater-accordion-repeater:first").clone(!0,!0),e(this).parents(".redux-repeater-accordion-repeater:first").slideUp("medium",function(){if(e(this).remove(),redux.field_objects.repeater.sort_repeaters(t),""!=redux.repeater[a].limit){var i=r.find(".redux-repeater-accordion-repeater").length;i<redux.repeater[a].limit&&r.find(".redux-repeaters-add").removeClass("button-disabled")}})});var c=t.find(".redux-repeater-accordion-repeater");c.hasClass("close-me")&&t.find(".redux-repeaters-remove").click(),String.prototype.reduxReplaceAll=function(e,r){return this.replace(new RegExp(e.replace(/[.^$*+?()[{\|]/g,"\\$&"),"g"),r)},t.find(".redux-repeaters-add").click(function(){if(!e(this).hasClass("button-disabled")){var r=e(this).parent().find(".redux-repeater-accordion:first"),a=r.find(".redux-repeater-accordion-repeater").length,i=r.attr("data-id");if(""!=redux.repeater[i].limit&&a>=redux.repeater[i].limit)return void e(this).addClass("button-disabled");a++;var d=r.find(".redux-repeater-accordion-repeater").size();r.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").hasClass("ui-state-active")&&r.find(".redux-repeater-accordion-repeater:last").find(".ui-accordion-header").click();var n=r.find(".redux-repeater-accordion-repeater:last").clone(!0,!0);if(0==n.length&&(n=redux.repeater[i].blank),redux.repeater[i]){redux.repeater[i].count=t.find(".redux-repeater-header").length;var c=redux.repeater[i].html.reduxReplaceAll("99999",d);e(n).find(".redux-repeater-header").text("")}n.find(".ui-accordion-content").html(c),e(r).append(n),redux.field_objects.repeater.sort_repeaters(n);var n=e(this).parent().find(".redux-repeater-accordion:first");n.find(".redux-repeater-accordion-repeater:last .ui-accordion-header").click(),n.find(".redux-repeater-accordion-repeater:last .bind_title").on("change keyup",function(r){var t;t=e(r.target).find(":selected").text().length>0?e(r.target).find(":selected").text():e(r.target).val(),e(this).closest(".redux-repeater-accordion-repeater").find(".redux-repeater-header").text(t)}),redux.repeater[i].limit>0&&a>=redux.repeater[i].limit&&e(this).addClass("button-disabled")}})}}})}}(jQuery);